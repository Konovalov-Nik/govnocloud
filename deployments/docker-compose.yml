version: '3'
services:
  node:
    image: loqutus/govnocloud-node
    ports:
      - "6969:6969"
    environment:
      "NODE_LIBVIRT_SOCKET" : "qemu+unix:///system?socket=/run/libvirt/libvirt-sock"
      "NODE_NAME": "node"
      "NODE_IP": "node"
    volumes:
      - /run/libvirt:/run/libvirt/
      - /var/run/libvirt:/var/run/libvirt
  etcd:
    image: quay.io/coreos/etcd:v3.2.4
    ports:
      - "2379:2379"
      - "2380:2380"
    environment:
      ETCD_LISTEN_CLIENT_URLS: http://0.0.0.0:2379
      ETCD_ADVERTISE_CLIENT_URLS: http://0.0.0.0:2379
  master:
    image: loqutus/govnocloud-master
    ports:
      - "7070:7070"
    environment:
      "MASTER_ETCD_HOST": "etcd"
      "MASTER_NODES": "node:node:6969"
    depends_on:
      - etcd
      - node
  web:
    image: loqutus/govnocloud-web
    ports:
      - "8080:8080"
    environment:
      "WEB_MASTER_HOST": "master"
    depends_on:
      - master
  test:
    image: loqutus/govnocloud-test
    environment:
      "TEST_MASTER_HOST": "master"
      "TEST_MASTER_PORT": "7070"
      "TEST_NODE_NAME": "node"
      "TEST_NODE_IP": "node"
      "TEST_NODE_PORT": "6969"
    depends_on:
      - master
      - node
